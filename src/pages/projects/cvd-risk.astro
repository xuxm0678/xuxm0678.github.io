---
import Layout from "../../layouts/PageLayout.astro";
import { motion } from "framer-motion";
import CVDRiskDemo from "~/components/CVDRiskDemo.tsx";

// 占位插图（若没有可先放任意图片，后续替换）
import heroImg from "~/assets/images/cvd-hero.png";
import bgImg from "~/assets/images/cvd-bg.png";
import riskImg from "~/assets/images/cvd-risk.png";

const metadata = {
  title: "Cardiovascular Risk Prediction",
  description:
    "AI-enabled risk scoring system integrating wearable, behavioral, and clinical data for interpretable digital health monitoring.",
};
---

<Layout metadata={metadata}>
  <!-- ===== Layered HERO (背景渐变 + 插图悬浮 + 居中标题) ===== -->
  <!-- ===== HERO (纯色渐变 + 左文案 + 右侧3D浮卡 + Scroll-Spy 胶囊) ===== -->
<section
  id="hero"
  class="relative isolate overflow-hidden min-h-[80vh] flex items-center"
>
  <!-- 背景：纯色渐变 + 微弱径向光斑 -->
  <div class="absolute inset-0 bg-gradient-to-br from-blue-700 via-cyan-600 to-teal-500 dark:from-[#0b1530] dark:via-[#0c213a] dark:to-[#103a46]"></div>
  <div class="pointer-events-none absolute -top-40 right-1/3 h-[38rem] w-[38rem] rounded-full bg-white/10 blur-[120px]"></div>

  <div class="relative z-10 max-w-[1400px] mx-auto w-full px-6 sm:px-10 lg:px-16 py-20">
    <div class="grid grid-cols-12 items-center gap-10">
      <!-- 左：标题/文案/CTA/胶囊 -->
      <div class="col-span-12 lg:col-span-6">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight tracking-tight text-white">
          Cardiovascular Risk<br/>Prediction System
        </h1>

        <p class="mt-5 text-white/90 text-lg md:text-xl leading-relaxed max-w-2xl">
          Real-time AI risk scoring from wearable, behavioral, and clinical data — built for proactive digital health monitoring.
        </p>

        <!-- CTA -->
        <div class="mt-8 flex flex-wrap gap-3">
          <a
            href="#demo"
            class="inline-flex items-center gap-2 rounded-xl bg-white px-5 py-3 font-semibold text-blue-700 shadow hover:shadow-lg hover:-translate-y-0.5 transition"
          >
            Try the Demo →
          </a>
          <a
            href="#methods"
            class="inline-flex items-center gap-2 rounded-xl border border-white/40 bg-white/10 px-5 py-3 font-semibold text-white/95 backdrop-blur-md hover:bg-white/20 transition"
          >
            Methods
          </a>
        </div>

        <!-- 胶囊导航（Scroll-Spy 高亮） -->
        <nav id="hero-pills" class="mt-10 flex flex-wrap gap-2">
          {[
            ["Background", "#background"],
            ["Objective", "#objective"],
            ["Methods", "#methods"],
            ["Findings", "#findings"],
            ["Demo", "#demo"],
            ["Impact", "#impact"],
          ].map(([label, href]) => (
            <a
              href={href}
              data-spy={href.replace("#", "")}
              class="px-4 py-2 rounded-full text-sm border border-white/25 bg-white/10 text-white/90 backdrop-blur-md hover:bg-white/20 transition
                     data-[active=true]:bg-white data-[active=true]:text-blue-700 data-[active=true]:border-white"
            >
              {label}
            </a>
          ))}
        </nav>
      </div>

<!-- 右侧：3D Tilt 预览卡片 -->
      <div class="col-span-12 lg:col-span-6 flex justify-center lg:justify-end">
        <div id="tilt-wrap" class="relative [perspective:1400px]">
          <img
            id="tilt-img"
            src="/assets/images/cvd-widget.png"
            alt="Cardiovascular Risk Preview"
            class="w-[360px] sm:w-[400px] lg:w-[440px] rounded-2xl shadow-[0_28px_80px_-18px_rgba(0,0,0,0.55)] transition-transform duration-300 will-change-transform"
            loading="eager"
          />
        </div>
      </div>
      
      <script>
        // ✅ 3D tilt effect (safe, small, no GPU overload)
        const wrap = document.getElementById("tilt-wrap");
        const img = document.getElementById("tilt-img");
      
        if (wrap && img) {
          wrap.addEventListener("mousemove", (e) => {
            const r = wrap.getBoundingClientRect();
            const x = (e.clientX - r.left) / r.width;
            const y = (e.clientY - r.top) / r.height;
            const rx = (0.5 - y) * 10;  // x-axis tilt
            const ry = (x - 0.5) * 14;  // y-axis tilt
            img.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) scale(1.05)`;
          });
      
          wrap.addEventListener("mouseleave", () => {
            img.style.transform = "rotateX(0deg) rotateY(0deg) scale(1)";
          });
        }
      </script>


            <!-- 底部说明 -->
            <div class="mt-4 flex items-center justify-between">
              <span class="text-xs text-white/70">Interactive demo preview</span>
              <a href="#demo" class="text-xs font-semibold text-white hover:underline">Open →</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 轻量 3D 倾斜交互 & Scroll-Spy 高亮 -->
  <script>
    // 3D tilt
    const wrap = document.getElementById('tilt-wrap');
    const card = document.getElementById('tilt-card');
    if (wrap && card) {
      wrap.addEventListener('mousemove', (e) => {
        const r = wrap.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;   // 0..1
        const y = (e.clientY - r.top) / r.height;  // 0..1
        const rx = (0.5 - y) * 10; // max 10deg
        const ry = (x - 0.5) * 12;
        card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`;
      });
      wrap.addEventListener('mouseleave', () => {
        card.style.transform = 'rotateX(0) rotateY(0) translateZ(0)';
      });
    }

    // Scroll-Spy
    const sections = ['background','objective','methods','findings','demo','impact'];
    const pills = new Map(
      Array.from(document.querySelectorAll('#hero-pills a')).map(a => [a.dataset.spy, a])
    );

    const io = new IntersectionObserver((entries) => {
      // 按“可见面积最大”高亮
      entries.forEach((entry) => {
        const id = entry.target.id;
        if (!pills.has(id)) return;
        if (entry.isIntersecting) {
          pills.forEach((el) => el.dataset.active = 'false');
          pills.get(id).dataset.active = 'true';
        }
      });
    }, { rootMargin: '-30% 0px -60% 0px', threshold: [0.2, 0.5, 0.8] });

    sections.forEach(id => {
      const el = document.getElementById(id);
      if (el) io.observe(el);
    });
  </script>

  <style is:global>
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
  </style>
</section>



  <!-- ===== 主体内容容器 ===== -->
  <main class="relative bg-white dark:bg-gray-950">
    <div class="max-w-[1600px] mx-auto px-8 sm:px-12 space-y-32 py-24">

      <!-- Background（左右图文） -->
      <section id="background" class="grid lg:grid-cols-2 gap-16 items-center">
        <div>
          <h2 class="text-3xl md:text-4xl font-bold text-blue-700 dark:text-blue-400 mb-5">Background</h2>
          <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed mb-4">
            Cardiovascular disease (CVD) remains the leading global cause of mortality. Traditional models like Framingham and ASCVD rely on static clinical measures, overlooking dynamic physiological and behavioral factors.
          </p>
          <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
            Wearable devices provide real-time indicators—<strong>heart rate, sleep efficiency, activity level</strong>—revealing daily stress and habits that can reshape how we understand risk.
          </p>
        </div>
        <div class="flex justify-center">
          <img src={bgImg.src} alt="Wearable data visualization"
               class="w-full max-w-xl rounded-3xl shadow-xl ring-1 ring-gray-200/60 dark:ring-gray-800/60" />
        </div>
      </section>

      <!-- Objective（中心发光卡片） -->
      <section id="objective" class="text-center">
        <div class="mx-auto max-w-4xl rounded-3xl p-10 sm:p-12 bg-gradient-to-r from-teal-50 to-blue-50 dark:from-gray-800 dark:to-gray-750 shadow-[0_20px_80px_-40px_rgba(0,0,0,.4)] ring-1 ring-gray-200/60 dark:ring-gray-700/60">
          <h2 class="text-3xl md:text-4xl font-semibold mb-4 text-gray-900 dark:text-white">Objective</h2>
          <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
            Build a reproducible pipeline integrating wearable signals and behavioral data to estimate risk and visualize interpretability using <strong>SHAP-style feature attributions</strong>.
          </p>
        </div>
      </section>

      <!-- Methods（四卡片 + hover） -->
      <section id="methods">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-gray-900 dark:text-white">Methods</h2>
        <div class="mt-10 grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
          {[
            ["Data Inputs", "Wearable signals and survey data — resting HR, sleep, activity, BMI, alcohol use, hypertension, diabetes."],
            ["Modeling", "Linear regression and XGBoost for nonlinearity and interaction effects, validated by 5×3 repeated CV (R² ≈ 0.63)."],
            ["Interpretation", "SHAP values reveal the individual-level influence of behavioral and physiological factors on predicted risk."],
            ["Outcome", "Composite risk index capturing multi-dimensional cardiovascular burden for personalized digital prevention."],
          ].map(([title, desc], i) => (
            <motion.div
              client:visible
              initial={{ opacity: 0, y: 22 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.45, delay: i * 0.05 }}
              class="group p-8 rounded-2xl bg-white/90 dark:bg-gray-900/80 backdrop-blur-sm border border-gray-200/70 dark:border-gray-800/70 shadow-sm hover:shadow-xl hover:-translate-y-0.5 transition"
            >
              <h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400 mb-2">{title}</h3>
              <p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed">{desc}</p>
            </motion.div>
          ))}
        </div>
      </section>

      <!-- Findings（左右图文） -->
      <section id="findings" class="grid lg:grid-cols-2 gap-16 items-center">
        <div>
          <h2 class="text-3xl md:text-4xl font-bold text-blue-700 dark:text-blue-400 mb-5">Key Findings</h2>
          <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
            <strong>Alcohol/drug use, BMI, and age</strong> increase risk, while <strong>sleep efficiency and physical activity</strong> reduce it. These insights highlight wearable-driven analytics as a tool for proactive health management.
          </p>
        </div>
        <div class="flex justify-center">
          <img src={riskImg.src} alt="SHAP feature importance"
               class="w-full max-w-xl rounded-3xl shadow-xl ring-1 ring-gray-200/60 dark:ring-gray-800/60" />
        </div>
      </section>

      <!-- Demo（产品化外框） -->
      <section id="demo" class="text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Interactive Demo</h2>
        <div class="mt-8 mx-auto max-w-4xl rounded-3xl bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border border-gray-200/70 dark:border-gray-800/70 shadow-[0_18px_80px_-30px_rgba(0,0,0,.35)] p-6 sm:p-10">
          <CVDRiskDemo client:visible />
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400 pt-6">* For educational and visualization purposes only.</p>
      </section>

      <!-- Impact & Next Steps（深色渐变CTA） -->
      <section id="impact" class="text-center">
        <div class="mx-auto max-w-5xl rounded-3xl p-12 sm:p-14 text-white bg-gradient-to-r from-blue-700 via-cyan-600 to-teal-500 shadow-[0_20px_90px_-40px_rgba(0,0,0,.6)]">
          <h2 class="text-3xl md:text-4xl font-extrabold">Impact & Next Steps</h2>
          <p class="mt-4 text-lg text-blue-50 leading-relaxed">
            This work demonstrates the potential of interpretable AI in preventive health. Next: expand datasets, validate across populations, and integrate the risk scoring system into digital health platforms.
          </p>
          <div class="mt-8">
            <a href="/consulting" class="inline-block px-7 py-3 rounded-xl bg-white text-blue-700 font-semibold hover:scale-[1.02] transition shadow">
              Collaborate or Learn More →
            </a>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 版权（简单） -->
  <footer class="py-10 text-center text-sm text-gray-500 dark:text-gray-400">
    © {new Date().getFullYear()} Xiaomeng “Maggie” Xu — Cardiovascular AI
  </footer>

  <!-- 全局样式：悬浮动画 & 深色微调 -->
  <style is:global>
    @keyframes float {
      0%, 100% { transform: translateY(0) }
      50% { transform: translateY(-10px) }
    }
    .animate-float { animation: float 8s ease-in-out infinite; }
  </style>
</Layout>
