---
import { motion } from "framer-motion";
import Image from "~/components/common/Image.astro";
import Layout from "../../layouts/PageLayout.astro";
import CVDRiskDemo from "~/components/CVDRiskDemo.tsx";
import CVDWidget from "~/components/CVDWidget.astro";

import heroImg from "~/assets/images/cvd-hero.png";
import shapImg from "~/assets/images/shap-summary.png";
import distImg from "~/assets/images/risk-distribution.png";


const metadata = {
  title: "Cardiovascular Risk Prediction",
  description:
    "A cardiovascular risk prediction model trained on patient records from the Michigan Medicine Precision Health EHR dataset, including demographic, biometric, and behavior-related variables.",
};
---

<Layout metadata={metadata}>

<!-- ================= HERO ================= -->
<section
  id="hero"
  class="relative isolate overflow-hidden min-h-[80vh] flex items-center"
>
  <!-- 背景渐变 -->
  <div class="absolute inset-0 bg-gradient-to-br from-blue-700 via-cyan-600 to-teal-500 dark:from-[#0b1530] dark:via-[#0c213a] dark:to-[#103a46]"></div>
  <div class="pointer-events-none absolute -top-40 right-1/3 h-[38rem] w-[38rem] rounded-full bg-white/10 blur-[120px]"></div>

  <div class="relative z-10 max-w-[1400px] mx-auto w-full px-6 sm:px-10 lg:px-16 py-20">
    <div class="grid grid-cols-12 items-center gap-10">

      <!-- 左侧文案 -->
      <div class="col-span-12 lg:col-span-6">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight tracking-tight text-white">
          Cardiovascular Risk<br/>Prediction System
        </h1>

        <p class="mt-5 text-white/90 text-lg md:text-xl leading-relaxed max-w-2xl">
          A cardiovascular risk prediction model trained on patient records from the Michigan Medicine Precision Health EHR dataset.
        </p>

        <div class="mt-8 flex flex-wrap gap-3">
          <a href="/projects/cvd-risk/demo" class="inline-flex items-center gap-2 rounded-xl bg-white px-5 py-3 font-semibold text-blue-700 shadow hover:shadow-lg hover:-translate-y-0.5 transition">
            Try the Demo →
          </a>
        </div>

        <!-- 胶囊导航 -->
        <nav id="hero-pills" class="mt-10 flex flex-wrap gap-2">
          {[
            ["Introduction", "#introduction"],
            ["Objective", "#objective"],
            ["Methods", "#methods"],
            ["Findings", "#findings"],
            ["Impact", "#impact"],
          ].map(([label, href]) => (
            <a
              href={href}
              data-spy={href.replace("#", "")}
              class="px-4 py-2 rounded-full text-sm border border-white/25 bg-white/10 text-white/90 backdrop-blur-md hover:bg-white/20 transition
                     data-[active=true]:bg-white data-[active=true]:text-blue-700 data-[active=true]:border-white"
            >
              {label}
            </a>
          ))}
        </nav>
      </div>

      <!-- 右侧 动态 UI Widget -->
      <div class="col-span-12 lg:col-span-6 flex justify-center lg:justify-end">
        <CVDWidget client:visible />
      </div>

    </div>
  </div>
</section>


<!-- ================= MAIN ================= -->
<main class="relative bg-white dark:bg-gray-950">
  <div class="max-w-[1600px] mx-auto px-8 sm:px-12 space-y-32 py-24">

   <section
  id="introduction"
  class="relative py-24 px-6 bg-gradient-to-b from-white to-[#f7fbff] dark:from-[#0a0f1a] dark:to-[#0e1828]"
>
  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-[1.35fr_1fr] gap-12 items-center">
    <!-- Left Text Block -->
    <div class="space-y-8 text-[18px] leading-relaxed text-gray-700 dark:text-gray-300">
      <p class="text-2xl font-medium text-gray-900 dark:text-white">
        Imagine if you could see your cardiovascular risk not once a year during a check-up, but every day.
      </p>

      <p>
        Cardiovascular disease (CVD) remains the <strong>#1 global cause of death</strong>, responsible for nearly one-third of annual fatalities. Traditional risk scores such as Framingham and ASCVD are calculated from a single static snapshot of clinical data. They identify who is high-risk, but not when someone is drifting toward danger in real time.
      </p>

      <p>
        Meanwhile, wearable devices continuously capture heart-rate trends, sleep regularity, and physical activity patterns, revealing the subtle rhythms of physiology and behavior that shape long-term risk. In this project, I reconstruct clinical risk scores from these real-world signals, turning yearly snapshots into a <strong>daily, behavior-aware estimate</strong>.
      </p>

      <p class="font-semibold text-gray-900 dark:text-white">
        Toward continuous, personalized prevention, making cardiovascular risk tracking more timely, actionable, and grounded in everyday life.
      </p>
    </div>

    <!-- Right Image Block -->
    <div class="flex justify-center lg:justify-end">
      <img
        src={heroImg.src}
        alt="Wearable AI CVD Concept"
        class="w-full max-w-md lg:max-w-lg rounded-xl drop-shadow-xl"
        loading="lazy"
      />
    </div>
  </div>
</section>


    <!-- Objective -->
    <section id="objective" class="text-center">
      <div class="mx-auto max-w-5xl rounded-3xl p-10 sm:p-12 bg-gradient-to-r from-teal-50 to-blue-50 dark:from-gray-800 dark:to-gray-750 shadow-[0_20px_80px_-40px_rgba(0,0,0,.4)] ring-1 ring-gray-200/60 dark:ring-gray-700/60">
        <h2 class="text-3xl md:text-4xl font-extrabold mb-8">Objective</h2>
        <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
          Build a continuous cardiovascular risk scoring system that reconstructs validated clinical risk scores using large-scale EHR data and behavior-linked physiological markers, with model interpretability exposed through SHAP-based explanations.
        </p>
      </div>
    </section>

    <!-- Methods -->
    <section id="methods" class="text-center">
  <h2 class="text-3xl md:text-4xl font-extrabold mb-8">Methods</h2>

  <!-- ✅ PIPELINE -->
  <div class="mb-16">
    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-6 text-center">
      End-to-End Modeling Pipeline
    </h3>

    <div class="flex flex-wrap justify-center gap-6 md:gap-8 lg:gap-10 max-w-6xl mx-auto">
      <div class="step-box">1. Extract EHR Data</div>
      <div class="arrow">→</div>

      <div class="step-box">2. Clean & Normalize<br><span class="sub">missing, outliers, coding</span></div>
      <div class="arrow">→</div>

      <div class="step-box">3. Feature Engineering<br><span class="sub">aggregation, scaling, encoding</span></div>
      <div class="arrow">→</div>

      <div class="step-box">4. Baseline Model<br><span class="sub">Linear Regression</span></div>
      <div class="arrow">→</div>

      <div class="step-box">5. XGBoost + Log Transform<br><span class="sub">hyperparameter tuning</span></div>
      <div class="arrow">→</div>

      <div class="step-box">6. 5×3 Repeated CV<br><span class="sub">stability validation</span></div>
      <div class="arrow">→</div>

      <div class="step-box">7. SHAP Explainability<br><span class="sub">individual risk drivers</span></div>
    </div>
  </div>

  <!-- ✅ 4 METHOD CARDS -->
  <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
    
    <div class="method-card">
      <h4 class="method-title">Data Inputs</h4>
      <p>
        33K+ longitudinal records combining wearable-derived metrics (resting heart rate, activity, sleep) and key clinical indicators (BMI, diabetes, hypertension, heart failure).
      </p>
    </div>

    <div class="method-card">
      <h4 class="method-title">Modeling</h4>
      <p>
        Started with a linear regression baseline (R² ≈ 0.20). Early XGBoost runs overfit, so the outcome was log-transformed and regularized, yielding consistent performance (mean cross-validated R² ≈ 0.63).
      </p>
    </div>

    <div class="method-card">
      <h4 class="method-title">Interpretation</h4>
      <p>
        SHAP values quantify individual-level risk drivers, exposing nonlinear effects of physiologic and lifestyle-linked predictors and enabling readable explanations.
      </p>
    </div>

    <div class="method-card">
      <h4 class="method-title">Outcome</h4>
      <p>
        A behavior-aware risk estimate that updates more frequently than static clinic-based scores, supporting early detection and preventive digital health intervention design.
      </p>
    </div>
  </div>
</section>

<style>
  /* ----------- Pipeline styles ----------- */
  .step-box {
    @apply border border-gray-300 dark:border-gray-600 rounded-xl px-5 py-4 text-center text-gray-800 dark:text-gray-200 text-sm font-medium bg-white/40 dark:bg-white/5 shadow-sm;
    min-width: 180px;
  }
  .arrow {
    @apply text-gray-500 dark:text-gray-400 text-2xl hidden md:flex items-center;
  }
  @media (max-width: 768px) {
    .arrow { display: none; }
    #pipeline .flex { flex-direction: column; gap: 14px; }
  }
  .sub { @apply text-xs opacity-70; }

  /* ----------- Method cards ----------- */
  .method-card {
    @apply bg-white/70 dark:bg-white/5 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-md backdrop-blur;
  }
  .method-title {
    @apply text-lg font-semibold text-blue-700 dark:text-blue-300 mb-3;
  }
</style>


   <section
  id="findings"
  class="relative w-screen left-[50%] right-[50%] ml-[-50vw] mr-[-50vw] py-20 px-6 sm:px-10 
  bg-gradient-to-br from-indigo-50 via-blue-50 to-cyan-50 
  dark:from-[#0a0f1f] dark:via-[#0c1830] dark:to-[#0b2040]"
>
  <!-- 标题区 -->
  <div class="max-w-5xl mx-auto text-center mb-16">
    <h2 class="text-3xl md:text-4xl font-extrabold mb-8">Findings</h2>
    <p class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed">
      Visualizing and interpreting the model’s internal logic and output distribution.
    </p>
  </div>

  <!-- 两个卡片区域 -->
  <div class="flex flex-col md:flex-row items-stretch justify-center gap-10 max-w-6xl mx-auto">
    <!-- 左：SHAP 图 -->
    <div class="flex-1 bg-white/70 dark:bg-white/10 backdrop-blur-md shadow-lg rounded-2xl p-6 flex flex-col items-center">
      <img src={shapImg.src} alt="SHAP summary plot" class="rounded-xl object-contain w-full h-[320px]" />
      <div class="mt-4 text-left text-gray-700 dark:text-gray-200 text-sm leading-relaxed">
        <h3 class="font-semibold text-lg mb-2 text-gray-900 dark:text-white text-center">Feature Contributions</h3>
        <ul class="list-disc list-inside space-y-1">
          <li>Each point represents one patient; the x-axis shows SHAP value (feature impact).</li>
          <li>Red = higher feature values (e.g., older age, higher BMI) → higher risk.</li>
          <li>Blue = lower values → often protective.</li>
          <li>Key drivers include <strong>Age</strong>, <strong>BMI</strong>, <strong>Sleep Efficiency</strong>, and <strong>Substance Use</strong>.</li>
        </ul>
      </div>
    </div>

    <!-- 右：分布图 -->
    <div class="flex-1 bg-white/70 dark:bg-white/10 backdrop-blur-md shadow-lg rounded-2xl p-6 flex flex-col items-center">
      <img src={distImg.src} alt="Log-transformed risk distribution" class="rounded-xl object-contain w-full h-[320px]" />
      <div class="mt-4 text-left text-gray-700 dark:text-gray-200 text-sm leading-relaxed">
        <h3 class="font-semibold text-lg mb-2 text-gray-900 dark:text-white text-center">Risk Score Distribution</h3>
        <ul class="list-disc list-inside space-y-1">
          <li>Predicted cardiovascular risk scores remain right-skewed after log transformation.</li>
          <li>30th & 70th percentiles define <strong>Low</strong>, <strong>Medium</strong>, and <strong>High</strong> risk tiers.</li>
          <li>Interpretability helps clinicians monitor risk trajectories over time.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 底部按钮 -->
  <div class="mt-16 flex justify-center">
    <a
      href="/projects/cvd-risk/demo"
      class="inline-flex items-center gap-2 px-7 py-3.5 bg-gradient-to-r from-sky-500 to-cyan-500 hover:from-sky-600 hover:to-cyan-600 text-white font-semibold rounded-full shadow-md transition-all"
    >
      View Interactive Demo →
    </a>
  </div>
</section>

    <!-- Impact -->
    <section id="impact" class="text-center">
      <div class="mx-auto max-w-5xl rounded-3xl p-12 sm:p-14 text-white bg-gradient-to-r from-blue-700 via-cyan-600 to-teal-500 shadow-[0_20px_90px_-40px_rgba(0,0,0,.6)]">
        <h2 class="text-3xl md:text-4xl font-extrabold">Impact & Next Steps</h2>
        <p class="mt-4 text-lg text-blue-50 leading-relaxed">
          The study underscores the potential of interpretable AI in preventive cardiology. Although the model was trained using single-institution data, future validation across heterogeneous populations is warranted. Further work will focus on integrating longitudinal EHR and wearable data to enable continuous, clinically actionable risk monitoring.
        </p>
        <div class="mt-8">
          <a href="/consulting" class="inline-block px-7 py-3 rounded-xl bg-white text-blue-700 font-semibold hover:scale-[1.02] transition shadow">
            Collaborate or Learn More →
          </a>
        </div>
      </div>
    </section>

  </div>
</main>

<footer class="py-10 text-center text-sm text-gray-500 dark:text-gray-400">
  © {new Date().getFullYear()} Maggie “Xiaomeng” Xu — Cardiovascular AI
</footer>

</Layout>
